<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC
   "-//W3C//DTD XHTML 1.0 Strict//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">

   <head>
      <script src = "../javascript/Color.js"></script>
      <script src = "../javascript/Square.js"></script>
      <script src = "../javascript/Shape.js"></script>

      <script src = "../javascript/shapes/IShape.js"></script>
      <script src = "../javascript/shapes/JShape.js"></script>
      <script src = "../javascript/shapes/JShape.js"></script>
      <script src = "../javascript/shapes/LShape.js"></script>
      <script src = "../javascript/shapes/OShape.js"></script>
      <script src = "../javascript/shapes/SShape.js"></script>
      <script src = "../javascript/shapes/TShape.js"></script>
      <script src = "../javascript/shapes/ZShape.js"></script>
   </head>

   <body>
      <table border = "1">
         <tr>
            <td>
               <form name = "myForm">
                  <input type="radio" name="shape" value="ishape" onclick="showShape(0);" checked="checked">I-Shape<br />
                  <input type="radio" name="shape" value="jshape" onclick="showShape(1);">J-Shape<br />
                  <input type="radio" name="shape" value="lshape" onclick="showShape(2);">L-Shape<br />
                  <input type="radio" name="shape" value="oshape" onclick="showShape(3);">O-Shape<br />
                  <input type="radio" name="shape" value="sshape" onclick="showShape(4);">S-Shape<br />
                  <input type="radio" name="shape" value="tshape" onclick="showShape(5);">T-Shape<br />
                  <input type="radio" name="shape" value="zshape" onclick="showShape(6);">Z-Shape<br />
                  <input type="button" id="btnToggle" value="move" onclick="toggle();">
               </form>
            </td>
            <td id = "svg_td" style = "overflow: visible;">
               <svg xmlns="http://www.w3.org/2000/svg"></svg>
            </td>
         </tr>
      </table>

      <script type="text/javascript">
      <!--

// dimensions of board
var NUMBER_COLUMNS = 10;
var NUMBER_ROWS = 15;

var svg = document.body.getElementsByTagName("svg")[0];

svg.setAttribute("height", NUMBER_ROWS * 20);
svg.setAttribute("width", NUMBER_COLUMNS * 20);

// draw board grid
var board = new Array(NUMBER_ROWS);
var square;

for(var row = 0; row < board.length; row++) {
   board[row] = new Array(NUMBER_COLUMNS);

   for(var column = 0; column < board[row].length; column++) {
      square = new Square();
      square.setSize(Shape.SQUARE_SIZE);
      square.setColor(Color.NONE);

      square.setYCoordinate(row * Shape.SQUARE_SIZE);
      square.setXCoordinate(column * Shape.SQUARE_SIZE);

      board[row][column] = square;
      board[row][column].appendTo(svg);
   }
}

board[1][1].setColor(Color.RED);
board[1][7].setColor(Color.RED);

var shape = getShape(0);
shape.appendTo(svg);
shape.setColor(Color.GREEN);

function showShape(i) {
   // remove old shape
   if(shape != undefined) {
      shape.detachFrom(svg);
   }

   shape = getShape(i);
   shape.appendTo(svg);
   shape.setColor(Color.GREEN);
}

function getShape(i) {
   var xOffset = 0;
   var yOffset = 0;
   var shape;

   if(i == 0) {
      shape = new IShape();

      // move shape 5-squares to the right
      xOffset = (5 * Shape.SQUARE_SIZE);

      // move shape 3-squares down
      yOffset = (3 * Shape.SQUARE_SIZE);
   }
   else if(i == 1) {
      shape = new JShape();

      xOffset = (4 * Shape.SQUARE_SIZE);
   }
   else if(i == 2) {
      shape = new LShape();

      xOffset = (5 * Shape.SQUARE_SIZE);
   }
   else if(i == 3) {
      shape = new OShape();

      xOffset = (4 * Shape.SQUARE_SIZE);
      yOffset = Shape.SQUARE_SIZE;
   }
   else if(i == 4) {
      shape = new SShape(); // can't move

      xOffset = (4 * Shape.SQUARE_SIZE);
      yOffset = Shape.SQUARE_SIZE;
   }
   else if(i == 5) {
      shape = new TShape();

      xOffset = (4 * Shape.SQUARE_SIZE);
      yOffset = Shape.SQUARE_SIZE;
   }
   else if(i == 6) {
      shape = new ZShape();

      xOffset = (5 * Shape.SQUARE_SIZE);
      yOffset = Shape.SQUARE_SIZE;
   }

   var squares = shape.getSquares();

   // for each square in shape
   for(var i = 0; i < squares.length; i++) {
      squares[i].setXCoordinate(squares[i].getXCoordinate() + xOffset);
      squares[i].setYCoordinate(squares[i].getYCoordinate() + yOffset);
   }

   return shape;
}


document.onkeypress = onKeyPress;

var LEFT_ARROW_KEY = 37;
var RIGHT_ARROW_KEY = 39;

function onKeyPress(event) {
   var keyCode = (event.keyCode || event.charCode);

   if(keyCode == LEFT_ARROW_KEY) {
      move_left();
   }

   if(keyCode == RIGHT_ARROW_KEY) {
      move_right();
   }   
}

function move_left() {

   var squares = shape.getSquares();
   var tmp, row, column;

   // for each square in shape
   for(var i = 0; i < squares.length; i++) {
      column = ((squares[i].getXCoordinate() - Shape.SQUARE_SIZE)/Shape.SQUARE_SIZE);
      row = (squares[i].getYCoordinate()/Shape.SQUARE_SIZE);

      if((column < 0) || (column >= NUMBER_COLUMNS)) {
         return;
      }

      if((row < 0) || (row >= NUMBER_ROWS)) {
         return;
      }

      if(Color.NONE != board[row][column].getColor()) {
         return;
      }
   }

   // for each square in shape
   for(var i = 0; i < squares.length; i++) {
      // move square one space to the left
      squares[i].setXCoordinate(squares[i].getXCoordinate() - Shape.SQUARE_SIZE);
   }
}

function move_right() {

   var squares = shape.getSquares();
   var row, column;

   // for each square in shape
   for(var i = 0; i < squares.length; i++) {
      column = ((squares[i].getXCoordinate() + Shape.SQUARE_SIZE)/Shape.SQUARE_SIZE);
      row = (squares[i].getYCoordinate()/Shape.SQUARE_SIZE);

      if((column < 0) || (column >= NUMBER_COLUMNS)) {
         return;
      }

      if((row < 0) || (row >= NUMBER_ROWS)) {
         return;
      }

      if(Color.NONE != board[row][column].getColor()) {
         return;
      }
   }

   // for each square in shape
   for(var i = 0; i < squares.length; i++) {
      // move square one space to the left
      squares[i].setXCoordinate(squares[i].getXCoordinate() + Shape.SQUARE_SIZE);
   }
}

function toggle() {
   var btn = document.getElementById("btnToggle");
   var value = btn.getAttribute("value");
   var radios = document.myForm.shape;

   if(value == "move") {
      for(var i = 0; i < radios.length; i++) {
         radios[i].disabled = true;
      }

      document.onkeypress = onKeyPress;
      btn.setAttribute("value", "select");
   }
   else {
      for(var i = 0; i < radios.length; i++) {
         radios[i].disabled = false;
      }

      document.onkeypress = undefined;
      btn.setAttribute("value", "move");
   }
}

      //-->
      </script>
   </body>
</html>
